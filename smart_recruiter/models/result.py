"""
Result Data Models
==================

Models for screening results, match results, and interviews.
"""

from pydantic import BaseModel, Field
from typing import List, Optional, Dict, Any
from datetime import datetime
from enum import Enum


class SkillMatch(BaseModel):
    """Individual skill matching result."""
    required_skill: str
    candidate_skill: Optional[str] = None
    match_score: float  # 0-1
    is_match: bool
    notes: Optional[str] = None


class MatchResult(BaseModel):
    """
    Result of skill matching between candidate and job.
    Produced by Skill Matcher Agent.
    """
    candidate_id: str
    job_id: str

    # Overall Score
    overall_score: float  # 0-100
    grade: str  # A, B, C, D, F

    # Skill Matching
    skill_matches: List[SkillMatch] = Field(default_factory=list)
    skill_coverage: float  # 0-1, what % of required skills matched
    matched_skills: List[str] = Field(default_factory=list)
    missing_skills: List[str] = Field(default_factory=list)
    bonus_skills: List[str] = Field(default_factory=list)

    # Experience Match
    experience_score: float  # 0-100
    experience_gap: float  # Years short/over

    # Education Match
    education_score: float  # 0-100

    # AI Assessment
    recommendation: str  # "Strong match", "Good match", "Weak match", "No match"
    ai_summary: Optional[str] = None
    strengths: List[str] = Field(default_factory=list)
    weaknesses: List[str] = Field(default_factory=list)

    # Timestamps
    evaluated_at: datetime = Field(default_factory=datetime.utcnow)

    @staticmethod
    def calculate_grade(score: float) -> str:
        """Calculate letter grade from score."""
        if score >= 90:
            return "A"
        elif score >= 80:
            return "B"
        elif score >= 70:
            return "C"
        elif score >= 60:
            return "D"
        else:
            return "F"


class ScreeningResult(BaseModel):
    """
    Overall screening result for a job.
    Summary of all candidate evaluations.
    """
    job_id: str
    total_candidates: int
    screened_at: datetime = Field(default_factory=datetime.utcnow)

    # Statistics
    qualified_count: int = 0
    unqualified_count: int = 0
    average_score: float = 0.0

    # Score Distribution
    score_distribution: Dict[str, int] = Field(default_factory=lambda: {
        "90-100": 0,
        "80-89": 0,
        "70-79": 0,
        "60-69": 0,
        "below_60": 0,
    })

    # Top Candidates
    top_candidates: List[Dict[str, Any]] = Field(default_factory=list)

    # Common Missing Skills
    common_missing_skills: List[str] = Field(default_factory=list)


class InterviewType(str, Enum):
    """Type of interview."""
    PHONE_SCREEN = "phone_screen"
    TECHNICAL = "technical"
    BEHAVIORAL = "behavioral"
    SYSTEM_DESIGN = "system_design"
    HIRING_MANAGER = "hiring_manager"
    CULTURE_FIT = "culture_fit"
    FINAL = "final"


class InterviewStatus(str, Enum):
    """Status of an interview."""
    SCHEDULED = "scheduled"
    CONFIRMED = "confirmed"
    COMPLETED = "completed"
    CANCELLED = "cancelled"
    RESCHEDULED = "rescheduled"
    NO_SHOW = "no_show"


class InterviewSchedule(BaseModel):
    """
    Scheduled interview.
    Created by Scheduler Agent.
    """
    id: Optional[str] = None
    candidate_id: str
    job_id: str

    # Interview Details
    interview_type: InterviewType = InterviewType.TECHNICAL
    scheduled_at: datetime
    duration_minutes: int = 60

    # Participants
    interviewer_name: Optional[str] = None
    interviewer_email: Optional[str] = None

    # Location
    is_remote: bool = True
    meeting_link: Optional[str] = None
    location: Optional[str] = None  # For in-person

    # Status
    status: InterviewStatus = InterviewStatus.SCHEDULED

    # Communication
    invite_sent: bool = False
    reminder_sent: bool = False

    # Feedback
    feedback: Optional[str] = None
    rating: Optional[int] = None  # 1-5

    # Timestamps
    created_at: datetime = Field(default_factory=datetime.utcnow)
    updated_at: datetime = Field(default_factory=datetime.utcnow)


class InterviewQuestion(BaseModel):
    """Interview question generated by Assessor Agent."""
    question: str
    category: str  # technical, behavioral, situational
    difficulty: str  # easy, medium, hard
    expected_answer_points: List[str] = Field(default_factory=list)
    time_minutes: int = 5


class InterviewKit(BaseModel):
    """
    Complete interview kit for a candidate.
    Generated by Assessor Agent.
    """
    candidate_id: str
    job_id: str

    # Questions by Category
    technical_questions: List[InterviewQuestion] = Field(default_factory=list)
    behavioral_questions: List[InterviewQuestion] = Field(default_factory=list)
    situational_questions: List[InterviewQuestion] = Field(default_factory=list)

    # Coding Challenge (if applicable)
    coding_challenge: Optional[Dict[str, Any]] = None

    # Evaluation Rubric
    evaluation_criteria: List[str] = Field(default_factory=list)
    scoring_guide: Optional[Dict[str, str]] = None

    # Customization Notes
    focus_areas: List[str] = Field(default_factory=list)  # Based on candidate gaps
    recommended_duration: int = 60  # minutes

    # Generated
    generated_at: datetime = Field(default_factory=datetime.utcnow)
